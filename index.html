<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lev's Birthday Weekend ‚Äì Portland 2025</title>
  <style>
    /* SIMPLE, LIGHTWEIGHT STYLES - PHASE 1 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #FFFEF0; /* Pale yellow */
      color: #333;
      line-height: 1.6;
      padding: 20px;
      /* Subtle paper texture */
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.03) 2px, rgba(0, 0, 0, 0.03) 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0, 0, 0, 0.03) 2px, rgba(0, 0, 0, 0.03) 4px);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #FFFEF8; /* Lighter pale yellow */
      padding: 40px;
      border-radius: 16px;
      box-shadow:
        0 4px 12px rgba(107, 38, 75, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(107, 38, 75, 0.1);
      position: relative;
      overflow: hidden;
    }

    /* Watercolor lobster and moose background decorations - multiple layers */
    .container::before {
      content: '';
      position: absolute;
      width: 400px;
      height: 400px;
      background-image: url('images/lightpurp_lobster_decor.png');
      background-size: contain;
      background-repeat: no-repeat;
      top: -50px;
      right: -80px;
      transform: rotate(25deg);
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
    }

    .container::after {
      content: '';
      position: absolute;
      width: 350px;
      height: 350px;
      background-image: url('images/pink_lobster_decor.png');
      background-size: contain;
      background-repeat: no-repeat;
      bottom: -30px;
      left: -60px;
      transform: rotate(-15deg);
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
    }

    /* Additional background decorations on body */
    body::before {
      content: '';
      position: fixed;
      width: 300px;
      height: 300px;
      background-image: url('images/purple_moose_decor.png');
      background-size: contain;
      background-repeat: no-repeat;
      top: 50%;
      left: -100px;
      transform: translateY(-50%) rotate(20deg);
      opacity: 0.12;
      z-index: -1;
      pointer-events: none;
    }

    body::after {
      content: '';
      position: fixed;
      width: 280px;
      height: 280px;
      background-image: url('images/pink_lobster_decor.png');
      background-size: contain;
      background-repeat: no-repeat;
      bottom: 15%;
      right: -90px;
      transform: rotate(-25deg);
      opacity: 0.12;
      z-index: -1;
      pointer-events: none;
    }

    /* Additional background decorations (outside container) */
    .bg-decoration {
      position: fixed;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      pointer-events: none;
      z-index: -1;
    }

    .bg-decoration-1 {
      width: 280px;
      height: 280px;
      background-image: url('images/green_lobster_decor.png');
      top: 10%;
      right: 3%;
      transform: rotate(20deg);
      opacity: 0.14;
    }

    .bg-decoration-2 {
      width: 260px;
      height: 260px;
      background-image: url('images/lightpurp_lighthouse_decor.png');
      top: 55%;
      left: 1%;
      transform: rotate(-12deg);
      opacity: 0.12;
    }

    .bg-decoration-3 {
      width: 270px;
      height: 270px;
      background-image: url('images/purple_moose_decor.png');
      bottom: 12%;
      right: 5%;
      transform: rotate(18deg);
      opacity: 0.15;
    }

    .bg-decoration-4 {
      width: 250px;
      height: 250px;
      background-image: url('images/pink_lobster_decor.png');
      top: 35%;
      left: 4%;
      transform: rotate(-15deg);
      opacity: 0.13;
    }

    .bg-decoration-5 {
      width: 265px;
      height: 265px;
      background-image: url('images/lightpurp_lighthouse_decor.png');
      bottom: 25%;
      right: 2%;
      transform: rotate(10deg);
      opacity: 0.14;
    }

    /* Ensure content stays above decorations */
    .container > * {
      position: relative;
      z-index: 1;
    }

    h1 {
      font-family: Georgia, 'Times New Roman', serif;
      color: #6b264b; /* Magenta purple */
      position: relative;
      margin-bottom: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      /* Embossed effect */
      text-shadow:
        1px 1px 0 rgba(255, 255, 255, 0.8),
        2px 2px 3px rgba(107, 38, 75, 0.2);
    }

    .subtitle {
      color: #6b264b; /* Magenta purple */
      margin-bottom: 20px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Header Info */
    .header-info {
      display: grid;
      gap: 15px;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #6b264b; /* Magenta purple */
      position: relative;
    }

    /* Watercolor lighthouse decoration in header */
    .header-info::before {
      content: '';
      position: absolute;
      width: 250px;
      height: 250px;
      background-image: url('images/lightpurp_lighthouse_decor.png');
      background-size: contain;
      background-repeat: no-repeat;
      top: -30px;
      right: -40px;
      opacity: 0.12;
      z-index: 0;
      pointer-events: none;
    }

    .info-box {
      background: rgba(187, 223, 50, 0.12); /* Light acid lime tint */
      padding: 15px;
      border-radius: 16px;
      border-left: 4px solid #bbdf32; /* Acid lime accent */
      position: relative;
      z-index: 1;
    }

    .info-label {
      font-weight: 700;
      color: #6b264b; /* Magenta purple */
      margin-bottom: 5px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: Georgia, serif;
    }

    /* Header Buttons Container */
    .header-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    /* Portland Favorites Map Button */
    .map-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #6b264b; /* Magenta purple */
      color: white;
      padding: 12px 20px;
      border-radius: 16px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.2s;
      border: 2px solid #6b264b;
      flex: 1;
    }

    .map-button:hover {
      background: #bbdf32; /* Acid lime on hover */
      color: #6b264b;
      border-color: #bbdf32;
    }

    .map-button-icon {
      width: 24px;
      height: 24px;
      filter: brightness(0) invert(1); /* Makes it white */
    }

    .map-button:hover .map-button-icon {
      filter: brightness(0) saturate(100%) invert(18%) sepia(53%) saturate(2463%) hue-rotate(311deg) brightness(89%) contrast(96%);
      /* Changes to magenta on hover */
    }

    /* Share Button */
    .share-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #6b264b; /* Magenta purple */
      color: white;
      padding: 12px 20px;
      border-radius: 16px;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.2s;
      border: 2px solid #6b264b;
      cursor: pointer;
      flex: 1;
    }

    .share-button:hover {
      background: #bbdf32; /* Acid lime on hover */
      color: #6b264b;
      border-color: #bbdf32;
    }

    .share-button-icon {
      width: 24px;
      height: 24px;
      filter: brightness(0) invert(1); /* Makes it white */
    }

    .share-button:hover .share-button-icon {
      filter: brightness(0) saturate(100%) invert(18%) sepia(53%) saturate(2463%) hue-rotate(311deg) brightness(89%) contrast(96%);
      /* Changes to magenta on hover */
    }

    /* Reset Header Button */
    .reset-header-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #6b264b; /* Magenta purple */
      color: white;
      padding: 12px 20px;
      border-radius: 16px;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.2s;
      border: 2px solid #6b264b;
      cursor: pointer;
      flex: 1;
    }

    .reset-header-button:hover {
      background: #fc8181;
      color: white;
      border-color: #fc8181;
    }

    .reset-button-icon {
      width: 24px;
      height: 24px;
      filter: brightness(0) invert(1); /* Makes it white */
    }

    .info-value {
      color: #333;
      font-size: 14px;
    }

    /* Section Groups */
    .section-group-title {
      font-size: 28px;
      font-weight: 700;
      color: #1a365d;
      margin: 40px 0 30px 0;
      padding-bottom: 10px;
      border-bottom: 3px solid #4299e1;
    }

    .section-group-title:first-child {
      margin-top: 20px;
    }

    /* Collapsible Tab Headers - Letterpress Style */
    .tab-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      margin: 40px 0 0 0;
      padding: 20px;
      border: 3px solid #6b264b; /* Magenta purple border */
      border-radius: 16px;
      background: rgba(187, 223, 50, 0.08); /* Subtle acid lime tint */
      position: relative;
    }

    .tab-header:first-child {
      margin-top: 20px;
    }

    .tab-header h2 {
      font-size: 32px;
      font-weight: 700;
      color: #6b264b; /* Magenta purple */
      margin: 0;
      font-family: Georgia, 'Times New Roman', serif;
      text-transform: uppercase;
      letter-spacing: 2px;
      /* Enhanced letterpress emboss effect */
      text-shadow:
        1px 1px 0 rgba(255, 255, 255, 0.8),
        2px 2px 4px rgba(107, 38, 75, 0.25);
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .fantasy-reminder-badge {
      font-size: 14px;
      font-weight: 600;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      text-transform: none;
      letter-spacing: 0.3px;
      background: linear-gradient(135deg, #bbdf32 0%, #a8cc28 100%);
      color: #6b264b;
      padding: 6px 14px;
      border-radius: 16px;
      text-shadow: none;
      border: 2px solid #8fb525;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.75; }
    }

    .tab-icon {
      width: 38px;
      height: 38px;
      filter: brightness(0) saturate(100%) invert(18%) sepia(53%) saturate(2463%) hue-rotate(311deg) brightness(89%) contrast(96%);
      /* This filter converts to magenta purple #6b264b */
    }

    .tab-collapse-btn {
      background: none;
      border: 2px solid #6b264b;
      cursor: pointer;
      font-size: 20px;
      color: #6b264b;
      padding: 8px 12px;
      transition: all 0.2s;
      border-radius: 16px;
    }

    .tab-collapse-btn:hover {
      background: #bbdf32; /* Acid lime */
      color: #6b264b;
      border-color: #bbdf32;
    }

    .tab-collapse-btn.collapsed {
      transform: rotate(-90deg);
    }

    /* Washington Baths blueberries decoration */
    .card[data-card-id="washington-baths"]::after {
      content: '';
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 45px;
      height: 45px;
      background-image: url('images/blueberries_button.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.3;
      z-index: 1;
      pointer-events: none;
    }

    /* Washington Baths keeps blueberries even when selected (Maine stamp will show via .card.selected::before) */

    /* Card background watermarks by category */
    /* Food/Restaurant cards - burger watermark */
    .card[data-card-id="central-provisions"]::before,
    .card[data-card-id="union"]::before,
    .card[data-card-id="the-juicery"]::before,
    .card[data-card-id="hot-suppa"]::before,
    .card[data-card-id="hunt-alpine"]::before,
    .card[data-card-id="blyth-burrows"]::before,
    .card[data-card-id="gritty-mcduffs"]::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      background-image: url('images/green_burger_button.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.06;
      z-index: 0;
      pointer-events: none;
    }

    /* Activity/Scenic cards - moose watermark */
    .card[data-card-id="old-port-novel"]::before,
    .card[data-card-id="victoria-mansion"]::before,
    .card[data-card-id="portland-head-light"]::before,
    .card[data-card-id="shopping"]::before,
    .card[data-card-id="pma-movie"]::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      background-image: url('images/green_moose_icon.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.05;
      z-index: 0;
      pointer-events: none;
    }

    /* Entertainment/Shows - negroni watermark */
    .card[data-card-id="pink-talking-fish"]::before,
    .card[data-card-id="blue-portland"]::before,
    .card[data-card-id="flask-lounge"]::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90px;
      height: 90px;
      background-image: url('images/pink_negroni_button.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.07;
      z-index: 0;
      pointer-events: none;
    }

    /* Hotel cards - tracks watermark */
    .card[data-card-id="hotel-checkin"]::before,
    .card[data-card-id="freshen-up"]::before,
    .card[data-card-id="hotel-checkout"]::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background-image: url('images/green_tracks_button.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.05;
      z-index: 0;
      pointer-events: none;
    }

    /* Ensure these watermarks don't override selected state's ::before (Maine stamp) */
    .card.selected[data-card-id="central-provisions"]::before,
    .card.selected[data-card-id="union"]::before,
    .card.selected[data-card-id="the-juicery"]::before,
    .card.selected[data-card-id="hot-suppa"]::before,
    .card.selected[data-card-id="hunt-alpine"]::before,
    .card.selected[data-card-id="blyth-burrows"]::before,
    .card.selected[data-card-id="gritty-mcduffs"]::before,
    .card.selected[data-card-id="old-port-novel"]::before,
    .card.selected[data-card-id="victoria-mansion"]::before,
    .card.selected[data-card-id="portland-head-light"]::before,
    .card.selected[data-card-id="shopping"]::before,
    .card.selected[data-card-id="pma-movie"]::before,
    .card.selected[data-card-id="pink-talking-fish"]::before,
    .card.selected[data-card-id="blue-portland"]::before,
    .card.selected[data-card-id="flask-lounge"]::before,
    .card.selected[data-card-id="hotel-checkin"]::before,
    .card.selected[data-card-id="freshen-up"]::before,
    .card.selected[data-card-id="hotel-checkout"]::before {
      /* Maine stamp takes priority when selected */
      width: 60px;
      height: 60px;
      background-image: url('images/green_deeppurp_mainestamp_button.png');
      top: 8px;
      right: 8px;
      left: auto;
      transform: rotate(-8deg) translate(0, 0);
      opacity: 0.3;
      z-index: 10;
    }

    .tab-content {
      max-height: 50000px;
      overflow: hidden;
      transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
      opacity: 1;
    }

    .tab-content.collapsed {
      max-height: 0;
      opacity: 0;
    }

    /* Sections */
    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 22px;
      font-weight: 700;
      color: #6b264b; /* Magenta purple */
      margin-bottom: 15px;
      font-family: Georgia, serif;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 10px 15px;
      background: rgba(187, 223, 50, 0.08);
      border-left: 4px solid #bbdf32;
      border-radius: 8px;
      /* Embossed effect */
      text-shadow:
        1px 1px 0 rgba(255, 255, 255, 0.7),
        1px 1px 2px rgba(107, 38, 75, 0.15);
    }

    .section-description {
      color: #718096;
      margin-bottom: 20px;
      font-size: 14px;
    }

    /* Cards */
    .card-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    .card {
      border: 3px solid #c4a4d4; /* Soft lavender border */
      border-radius: 16px;
      padding: 11px 12px 10px 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
      box-shadow: 2px 2px 0 rgba(196, 164, 212, 0.1);
      min-height: 120px;
      position: relative;
    }

    .card:hover {
      border-color: #bbdf32; /* Acid lime on hover */
      box-shadow: 0 0 0 1px rgba(187, 223, 50, 0.5),
                  0 8px 20px rgba(187, 223, 50, 0.3);
      transform: translate(0, -2px);
    }

    .card.selected {
      border: 3px solid rgba(187, 223, 50, 0.9); /* Acid lime when selected */
      background: rgba(187, 223, 50, 0.08); /* Light acid lime tint */
      box-shadow:
        0 0 0 1px rgba(187, 223, 50, 0.75),
        0 18px 40px rgba(187, 223, 50, 0.7);
    }

    /* Selected card indicator - Maine stamp only */
    .card.selected::before {
      content: '';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 60px;
      height: 60px;
      background-image: url('images/green_deeppurp_mainestamp_button.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.3;
      transform: rotate(-8deg);
      z-index: 10;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #6b264b; /* Magenta purple */
      margin-bottom: 8px;
      font-family: Georgia, serif;
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .card-tag-badge {
      display: inline-block;
      background: transparent;
      color: #6b264b; /* Magenta purple */
      padding: 4px 12px;
      border-radius: 16px;
      border: 2px solid #c4a4d4; /* Soft lavender */
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card.selected .card-tag-badge {
      background: #bbdf32; /* Acid lime fill */
      color: #6b264b; /* Magenta purple text */
      border-color: #bbdf32;
    }

    .card-description {
      color: #4a5568;
      font-size: 14px;
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .card-details {
      color: #718096;
      font-size: 13px;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .card-links {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .card-link {
      display: inline-block;
      padding: 6px 12px;
      background: #edf2f7;
      color: #4a5568;
      text-decoration: none;
      border-radius: 4px;
      font-size: 12px;
      transition: all 0.2s;
    }

    .card-link:hover {
      background: #e2e8f0;
      color: #2d3748;
    }

    /* Quick Link Buttons */
    .card-quick-links {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .quick-link-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: transparent;
      color: #6b264b; /* Magenta purple text */
      text-decoration: none;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      border: 2px solid #c4a4d4; /* Soft lavender border */
      text-transform: uppercase;
      letter-spacing: 0.3px;
      opacity: 0.85;
      min-height: 44px; /* iOS minimum touch target */
    }

    .quick-link-btn:hover {
      background: rgba(187, 223, 50, 0.15);
      color: #6b264b;
      border-color: #bbdf32;
      opacity: 1;
      transform: translateY(-1px);
    }

    .card.selected .quick-link-btn {
      background: rgba(107, 38, 75, 0.08);
      border-color: #6b264b;
      color: #6b264b;
      opacity: 0.9;
    }

    .card.selected .quick-link-btn:hover {
      opacity: 1;
    }

    .quick-link-icon {
      width: 18px;
      height: 18px;
      filter: brightness(0) saturate(100%) invert(18%) sepia(53%) saturate(2463%) hue-rotate(311deg) brightness(89%) contrast(96%);
      /* Converts icon to magenta purple */
      opacity: 1;
    }

    .quick-link-btn:hover .quick-link-icon {
      opacity: 1;
      transform: scale(1.1);
    }

    .card.selected .quick-link-btn .quick-link-icon {
      opacity: 1;
    }

    /* Expandable sections */
    .expand-button {
      width: 100%;
      padding: 12px;
      background: rgba(187, 223, 50, 0.1);
      border: 2px solid #bbdf32;
      border-radius: 16px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #6b264b;
      margin-top: 20px;
      transition: all 0.2s;
    }

    .expand-button:hover {
      background: rgba(187, 223, 50, 0.2);
    }

    .expand-button.enabled {
      background: rgba(187, 223, 50, 0.25);
      border-color: #bbdf32;
      color: #6b264b;
      cursor: pointer;
    }

    .expandable-content {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: rgba(187, 223, 50, 0.05);
      border-radius: 16px;
    }

    .expandable-content.show {
      display: block;
    }

    /* Mini cards for stores */
    .mini-card {
      border: 2px solid #c4a4d4;
      padding: 15px;
      border-radius: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }

    .mini-card:hover {
      border-color: #bbdf32;
      background: rgba(187, 223, 50, 0.05);
    }

    .mini-card.selected {
      border-color: #bbdf32;
      background: rgba(187, 223, 50, 0.15);
    }

    .mini-card-title {
      font-weight: 600;
      color: #6b264b;
      margin-bottom: 5px;
    }

    .mini-card-description {
      font-size: 13px;
      color: #4a5568;
      margin-bottom: 8px;
    }

    /* Summary Panel */
    .summary-panel {
      position: sticky;
      top: 20px;
      background: linear-gradient(135deg, #6b264b 0%, #8b3a6b 100%); /* Magenta purple gradient */
      padding: 25px;
      border-radius: 16px;
      border: 3px solid #6b264b;
      margin-bottom: 30px;
      max-height: 240px;
      overflow-y: auto;
      box-shadow: 0 8px 24px rgba(107, 38, 75, 0.35);
      z-index: 100; /* Stay on top of cards */
      position: relative;
    }

    .summary-expand-btn {
      position: absolute;
      top: 25px;
      right: 25px;
      background: #bbdf32;
      color: #6b264b;
      border: none;
      border-radius: 16px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      transition: all 0.2s;
    }

    .summary-expand-btn:hover {
      background: white;
      transform: scale(1.05);
    }

    /* Full screen summary modal */
    .summary-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .summary-modal.show {
      display: flex;
    }

    .summary-modal-content {
      background: linear-gradient(135deg, #6b264b 0%, #8b3a6b 100%);
      padding: 40px;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(107, 38, 75, 0.5);
    }

    .summary-modal-close {
      float: right;
      background: #bbdf32;
      color: #6b264b;
      border: none;
      border-radius: 16px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      transition: all 0.2s;
      margin-bottom: 20px;
    }

    .summary-modal-close:hover {
      background: white;
    }

    .summary-panel::-webkit-scrollbar {
      width: 10px;
    }

    .summary-panel::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
    }

    .summary-panel::-webkit-scrollbar-thumb {
      background: #bbdf32; /* Acid lime */
      border-radius: 16px;
    }

    .summary-title {
      font-size: 20px;
      font-weight: 700;
      color: white;
      margin-bottom: 15px;
      font-family: Georgia, serif;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 2px solid #bbdf32; /* Acid lime underline */
      padding-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .summary-icon {
      width: 28px;
      height: 28px;
      filter: brightness(0) invert(1); /* Makes it white */
    }

    .summary-section {
      margin-bottom: 15px;
    }

    .summary-section-title {
      font-weight: 600;
      color: white;
      margin-bottom: 5px;
    }

    .summary-day {
      font-size: 14px;
      font-weight: 700;
      color: white;
      margin-top: 15px;
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 2px solid rgba(187, 223, 50, 0.5);
      letter-spacing: 0.5px;
    }

    .summary-day:first-of-type {
      margin-top: 0;
    }

    .summary-item {
      color: rgba(255, 255, 255, 0.95);
      font-size: 14px;
      margin-bottom: 5px;
      font-family: 'Courier New', Courier, monospace;
      white-space: pre;
    }

    .summary-empty {
      color: rgba(255, 255, 255, 0.8);
      font-style: italic;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #e2e8f0;
      text-align: center;
      color: #718096;
    }

    .reset-button {
      margin: 20px 0;
      padding: 10px 20px;
      background: white;
      border: 2px solid #c4a4d4;
      border-radius: 16px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      color: #6b264b;
    }

    .reset-button:hover {
      border-color: #fc8181;
      color: #c53030;
      background: rgba(252, 129, 129, 0.05);
    }

    /* Hidden utility */
    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
        border-radius: 12px;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 8px;
      }

      .subtitle {
        font-size: 12px;
        margin-bottom: 15px;
      }

      .header-info {
        gap: 12px;
        margin-bottom: 20px;
        padding-bottom: 15px;
      }

      .header-info::before {
        width: 180px;
        height: 180px;
        top: -20px;
        right: -30px;
      }

      .info-box {
        padding: 12px;
        border-radius: 12px;
      }

      .info-label {
        font-size: 11px;
      }

      .info-value {
        font-size: 13px;
      }

      .header-buttons {
        flex-direction: column;
        gap: 8px;
      }

      .map-button,
      .share-button,
      .reset-header-button {
        width: 100%;
        padding: 12px 16px;
        font-size: 13px;
      }

      .tab-header {
        padding: 15px;
        margin: 30px 0 0 0;
        border-radius: 12px;
      }

      .tab-header:first-child {
        margin-top: 15px;
      }

      .tab-header h2 {
        font-size: 22px;
        letter-spacing: 1px;
        gap: 8px;
      }

      .tab-icon {
        width: 28px;
        height: 28px;
      }

      .fantasy-reminder-badge {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 12px;
        white-space: nowrap;
      }

      .tab-collapse-btn {
        padding: 6px 10px;
        font-size: 18px;
      }

      .section {
        margin-bottom: 30px;
      }

      .section-title {
        font-size: 18px;
        padding: 8px 12px;
        margin-bottom: 12px;
      }

      .section-description {
        font-size: 13px;
        margin-bottom: 15px;
      }

      .card-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .card {
        padding: 12px;
        min-height: auto;
      }

      .card.selected::before {
        width: 50px;
        height: 50px;
        top: 6px;
        right: 6px;
      }

      .card-title {
        font-size: 16px;
        margin-bottom: 6px;
      }

      .card-tag-badge {
        font-size: 10px;
        padding: 3px 10px;
      }

      .card-description {
        font-size: 13px;
        margin-bottom: 8px;
      }

      .card-details {
        font-size: 12px;
        margin-bottom: 10px;
      }

      .card-quick-links {
        gap: 6px;
        margin-top: 10px;
      }

      .quick-link-btn {
        font-size: 12px;
        padding: 8px 12px;
        gap: 6px;
      }

      .quick-link-icon {
        width: 16px;
        height: 16px;
      }

      .summary-panel {
        padding: 20px;
        margin-bottom: 20px;
        max-height: 200px;
      }

      .summary-title {
        font-size: 16px;
        margin-bottom: 12px;
        padding-bottom: 6px;
      }

      .summary-icon {
        width: 22px;
        height: 22px;
      }

      .summary-expand-btn {
        top: 20px;
        right: 20px;
        padding: 6px 12px;
        font-size: 11px;
      }

      .summary-day {
        font-size: 13px;
        margin-top: 12px;
        margin-bottom: 6px;
      }

      .summary-item {
        font-size: 12px;
        line-height: 1.4;
      }

      .expand-button {
        padding: 10px;
        font-size: 13px;
        margin-top: 15px;
      }

      .mini-card {
        padding: 12px;
        margin-bottom: 10px;
      }

      .mini-card-title {
        font-size: 14px;
      }

      .mini-card-description {
        font-size: 12px;
      }

      .reset-button {
        font-size: 13px;
        padding: 10px 18px;
      }

      .footer p {
        font-size: 13px;
      }

      /* Watercolor decorations - reduce size on mobile */
      .container::before {
        width: 250px;
        height: 250px;
        top: -30px;
        right: -50px;
      }

      .container::after {
        width: 220px;
        height: 220px;
        bottom: -20px;
        left: -40px;
      }

      body::before {
        width: 200px;
        height: 200px;
        left: -80px;
      }

      body::after {
        width: 180px;
        height: 180px;
        right: -70px;
      }
    }

    /* Extra small phones */
    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }

      h1 {
        font-size: 24px;
      }

      .tab-header h2 {
        font-size: 18px;
        flex-wrap: wrap;
      }

      .fantasy-reminder-badge {
        font-size: 10px;
        padding: 3px 8px;
        margin-top: 4px;
      }

      .section-title {
        font-size: 16px;
      }

      .card-title {
        font-size: 15px;
      }

      .quick-link-btn {
        font-size: 11px;
        padding: 7px 10px;
      }

      .summary-panel {
        padding: 15px;
      }

      .summary-title {
        font-size: 14px;
      }

      .summary-item {
        font-size: 11px;
      }
    }
</style>
</head>
<body>
  <div class="container">
    <h1>Lev's Birthday Weekend</h1>
    <div class="subtitle">Portland, Maine ‚Ä¢ December 20-21, 2025</div>

    <!-- Header Info -->
    <div class="header-info">
      <div class="info-box" style="background: rgba(187, 223, 50, 0.15); border-left-width: 4px;">
        <div class="info-label" style="font-size: 14px; color: #6b264b; margin-bottom: 10px;">How to Use This Interactive Itinerary</div>
        <div class="info-value" style="font-size: 13px; line-height: 1.7;">
          <p style="margin: 0 0 8px 0;">‚ú® <strong>Explore Your Options</strong> ‚Äì Click sections to see activities curated for you</p>
          <p style="margin: 0 0 8px 0;">üéØ <strong>Build Your Itinerary</strong> ‚Äì Select what interests you (auto-saves!)</p>
          <p style="margin: 0 0 8px 0;">üìã <strong>Track Your Plans</strong> ‚Äì See your schedule update in real-time</p>
          <p style="margin: 0 0 8px 0;">üîÑ <strong>Change Anytime</strong> ‚Äì Click "Reset All" or pick new options</p>
          <p style="margin: 0;">üó∫Ô∏è <strong>Easy Navigation</strong> ‚Äì Every option has map links (üìç) and websites</p>
        </div>
      </div>
      <div class="info-box">
        <div class="info-label">Goal</div>
        <div class="info-value">Kicking off your 35th rotation around the sun!</div>
      </div>
      <div class="header-buttons">
        <a href="https://maps.app.goo.gl/qncvtMqeFtQFpso37" target="_blank" class="map-button">
          <img src="images/green_maine_map_button.png" alt="Map" class="map-button-icon">
          Portland Map
        </a>
        <button class="share-button" id="share-link-btn" onclick="copyShareLink()" data-share-url="">
          <img src="images/green_lobster_decor.png" alt="Share" class="share-button-icon">
          Share Link
        </button>
        <button class="reset-header-button" id="reset-header-btn">
          <img src="images/orange_tracks_button.png" alt="Reset" class="reset-button-icon">
          Reset All
        </button>
      </div>
    </div>

    <!-- Summary Panel -->
    <div class="summary-panel">
      <button class="summary-expand-btn" id="expand-summary-btn">‚õ∂ Expand</button>
      <div class="summary-title">
        <img src="images/pink_negroni_button.png" alt="Cocktail" class="summary-icon">
        Your Weekend Summary
      </div>
      <div id="summary-content" class="summary-empty">
        Make selections below to build your weekend!
      </div>
    </div>

    <!-- Full Screen Summary Modal -->
    <div class="summary-modal" id="summary-modal">
      <div class="summary-modal-content">
        <button class="summary-modal-close" id="close-summary-modal">‚úï Close</button>
        <div class="summary-title">
          <img src="images/pink_negroni_button.png" alt="Cocktail" class="summary-icon">
          Your Weekend Summary
        </div>
        <div id="summary-modal-content"></div>
      </div>
    </div>

    <!-- All Content -->
    <div id="content-container"></div>

    <!-- Footer -->
    <div class="footer">
      <p>Your selections save automatically</p>
      <button class="reset-button" id="reset-btn">Reset All Selections</button>
      <p style="margin-top: 20px; font-size: 16px; color: #2d3748;">Note: You are loved!</p>
    </div>
  </div>

  <!-- Additional background decorations (outside container) -->
  <div class="bg-decoration bg-decoration-1"></div>
  <div class="bg-decoration bg-decoration-2"></div>
  <div class="bg-decoration bg-decoration-3"></div>
  <div class="bg-decoration bg-decoration-4"></div>
  <div class="bg-decoration bg-decoration-5"></div>

  <script>
    // ============================================
    // CONTENT DATA - EDIT THIS SECTION TO UPDATE ACTIVITIES
    // ============================================
    const CONTENT = {
      // ============================================
      // TAB 1: HEADING OUT
      // ============================================
      headingOut: {
        sections: [
          {
            id: 'departure-time',
            title: 'Choose Your Departure Time',
            description: 'Pick when you want to hit the road',
            selectionType: 'single',
            cards: [
              {
                id: 'depart-10am',
                title: 'Leave at 10:00 AM',
                time: '10:00a',
                tag: 'Early Start',
                description: 'Arrive by 12pm, more time in Portland'
              },
              {
                id: 'depart-11am',
                title: 'Leave at 11:00 AM',
                time: '11:00a',
                tag: 'Balanced',
                description: 'Arrive by 1pm, good balance'
              },
              {
                id: 'depart-12pm',
                title: 'Leave at 12:00 PM',
                time: '12:00p',
                tag: 'Leisurely',
                description: 'Arrive by 2pm, relaxed morning'
              }
            ]
          },
          {
            id: 'before-checkin',
            title: 'Before Check-In Activities',
            description: 'Pick activities to fill time before dinner at 5:30pm. Reminder: we can check-in to the hotel starting at 3pm. <strong>Your departure time determines how many activities you can select: 10am = 3 activities, 11am = 2 activities, Noon = 1 activity.</strong>',
            selectionType: 'multiple',
            cards: [
              {
                id: 'old-port-novel',
                title: 'Explore Old Port + Novel Cocktail Bar',
                time: '12:00p',
                tag: 'Wander & Drinks',
                description: 'Wander the district, warm up with cocktails at Novel, see the lobster trap trees',
                links: [
                  { text: 'Old Port', url: 'https://maps.app.goo.gl/TMwTqYxuPjjMQEmZA' },
                  { text: 'Novel', url: 'https://maps.app.goo.gl/g6gTPQq5osMav4WB7' },
                  { text: 'Novel', url: 'https://www.novelmaine.com/' },
                  { text: 'About Trees', url: 'https://92moose.fm/lobster-trap-christmas-trees-maine/' }
                ]
              },
              {
                id: 'washington-baths',
                title: 'Washington Baths',
                time: '12:00p',
                tag: 'Relax & Recharge',
                description: 'Arrive early for ultimate relaxation. Sauna, cold plunge, hot pool (no time limit). Show up refreshed for check-in.',
                details: '$36/person, no time limit, Saturday hours: 12pm-9pm ‚Ä¢ Bring bathing suit, towel, sandals (towels $3 to rent)',
                address: '547 Washington Ave, Portland, ME',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/f2xBGmGCVoqZvhFN9' },
                  { text: 'Website', url: 'https://washingtonbaths.com/' },
                  { text: 'FAQs', url: 'https://washingtonbaths.com/faq.html' }
                ]
              },
              {
                id: 'victoria-mansion',
                title: 'Victoria Mansion',
                time: '12:00p',
                tag: 'Museum & History',
                description: 'Stunning Victorian architecture, holiday decor tour. Perfect for history buffs.',
                details: 'Plan for 1-1.5 hours',
                address: 'Victoria Mansion, Portland, ME',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/EnE277KkfbquWMmN7' },
                  { text: 'Website', url: 'https://victoriamansion.org/' },
                  { text: 'Tickets', url: 'https://victoriamansion.org/visit-us/' }
                ]
              },
              {
                id: 'portland-head-light',
                title: 'Portland Head Light',
                time: '12:00p',
                tag: 'Scenic Stop',
                description: 'Cape Elizabeth\'s iconic lighthouse at Fort Williams Park. Quintessential Maine photo op and scenic coastal views‚Äîfree to visit, 15 minutes from downtown.',
                details: 'Cape Elizabeth, iconic lighthouse, Fort Williams Park (free)',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/iYV8cQbviunxzek96' },
                  { text: 'Website', url: 'https://portlandheadlight.com/' }
                ]
              },
              {
                id: 'frost-factory-saturday',
                title: 'Frost Factory',
                time: '12:00p',
                tags: ['Cannabis Dispensary', 'Birthday Gift'],
                description: 'South Portland, 10am-8pm. Stop by on the way into town or before hotel check-in.',
                details: 'Open 10am-8pm Saturday',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/D4ik3m1t8gCvXvjn8' },
                  { text: 'Website', url: 'https://thefrostfactory.com' },
                  { text: 'Preorder', url: 'https://weedmaps.com/dispensaries/the-frost-factory-2' }
                ]
              }
            ]
          }
        ]
      },

      // ============================================
      // TAB 2: SATURDAY NIGHT
      // ============================================
      saturdayNight: {
        sections: [
          {
            id: 'checkin-freshen',
            title: 'Check-In & Freshen Up',
            description: 'Arrive at the hotel and get ready for the evening',
            selectionType: 'multiple',
            cards: [
              {
                id: 'hotel-checkin',
                title: '3:00 PM - Check-In',
                time: '3:00p',
                tag: 'Hotel',
                description: 'Drop bags, check out harbor views, etc. etc.',
                address: 'AC Hotel Portland Downtown/Waterfront',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/qVkQX8hTFQEstE22A' },
                  { text: 'Website', url: 'https://www.marriott.com/en-us/hotels/pwmac-ac-hotel-portland-downtown-waterfront-me/overview/?scid=f2ae0541-1279-4f24-b197-a979c79310b0' },
                  { text: 'Hotel Food and Drink Options', url: 'https://www.marriott.com/en-us/hotels/pwmac-ac-hotel-portland-downtown-waterfront-me/dining/' }
                ]
              },
              {
                id: 'freshen-up',
                title: '4:30 PM - Freshen Up',
                time: '4:30p',
                tag: 'Get Ready',
                description: 'Ain\'t nobody dope as WE I\'m dressed so fresh so clean\n(And we are...) the coolest motherfunkers on the planet\n(In my mind...) the sky is fallin ain\'t no need to panic\n(But Oh oh.....) I got a stick and want yo automatic\n(Oh oh oh...) Compatible created in the attic',
                links: [
                  { text: 'So Fresh, So Clean', url: 'https://open.spotify.com/track/6glsMWIMIxQ4BedzLqGVi4?si=a8a67e0c9f584a6e' }
                ]
              }
            ]
          },
          {
            id: 'dinner',
            title: 'Dinner',
            description: 'Confirmed reservation at Central Provisions',
            selectionType: 'single',
            cards: [
              {
                id: 'central-provisions',
                title: '5:30 PM - Dinner',
                time: '5:30p',
                tag: 'Reservation Confirmed',
                description: '5 min walk from hotel, tapas-style shareables, good cocktails',
                address: 'Central Provisions',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/4VLy6RwdtkrGrEvP8' },
                  { text: 'Menu', url: 'http://www.central-provisions.com/menus' }
                ]
              }
            ]
          },
          {
            id: 'show',
            title: 'Saturday Night Entertainment',
            description: 'Select your entertainment for Saturday evening',
            selectionType: 'single',
            cards: [
              {
                id: 'pink-talking-fish',
                title: 'Pink Talking Fish at State Theatre',
                time: '8:00p',
                tag: 'Tickets Secured',
                description: 'Doors 7pm, Show 8pm, 5 min walk from dinner',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/yduqxtskCQKXiBSS7' },
                  { text: 'Tickets', url: 'https://click.email.ticketmaster.com/?qs=0b8e3ecdf60ecfccb3cb93cb65494801d247caec1fe2c925ea24196d5abad4eebc1360df9a6c1843d0c7cc6746467272f01a830c574ab2aa0fcce2bbc9891ea9' },
                  { text: 'Details', url: 'https://statetheatreportland.com/events/pink-talking-fish/' },
                  { text: 'Band', url: 'https://www.pinktalkingfish.com/' }
                ]
              },
              {
                id: 'blue-portland',
                title: 'Blue Portland Maine',
                time: '7:00p',
                tag: 'Live Jazz',
                description: 'Intimate live-music bar on Congress Street that hosts jazz, folk, and other small-venue shows',
                details: 'Doors 6pm, Carl Dimow Jazz Quartet @ 7pm, Rot On The Vine @ 9PM. Pay What You Can at the door, bring cash!',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/UC4stiNfQf7Ntf7T8' },
                  { text: 'Website', url: 'http://www.blueportlandmaine.org/' }
                ]
              }
            ]
          },
          {
            id: 'late-night',
            title: 'Late Night',
            description: 'How would you like to wrap up the evening?',
            selectionType: 'multiple',
            cards: [
              {
                id: 'hunt-alpine',
                title: 'Hunt & Alpine',
                time: '10:30p',
                tag: 'Cocktails & Small Plates',
                description: 'Scandinavian small plates & clever cocktails in a minimalist space with a bar & communal tables.',
                details: '10:30pm reservation ‚Ä¢ Menu highlights: Bonecrusher (mezcal, lime, red pepper), Green Chili Popcorn, Green Eyes (gin, green chartreuse, lime, egg whites), Oysters, Espresso Martini',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/G5WbA7GazA23xxb79' },
                  { text: 'Website', url: 'http://www.huntandalpineclub.com/' },
                  { text: 'Menu', url: 'https://indd.adobe.com/view/a2f6449c-e917-4f42-ac98-4158a9899f4a' }
                ]
              },
              {
                id: 'blyth-burrows',
                title: 'Blyth & Burrows',
                time: '10:00p',
                tag: 'Upscale Cocktails',
                description: 'Vintage-inspired cocktail bar with a maritime theme serving house cocktails & upscale small plates.',
                details: 'Saturday: 12 PM‚Äì12 AM',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/5KSA2oB92Ak83nC8A' },
                  { text: 'Website', url: 'https://www.blythandburrows.com/?utm_source=google&utm_medium=mybusiness' },
                  { text: 'Menu', url: 'https://www.blythandburrows.com/menu-2/?utm_source=google&utm_medium=mybusiness' }
                ]
              },
              {
                id: 'gritty-mcduffs',
                title: 'Gritty McDuff\'s Brew Pub',
                time: '10:00p',
                tag: 'Casual Brewpub',
                description: 'Classic Old Port brewpub known for its house ales and lively but unfussy atmosphere; open until about 1am on Saturdays, it fits well as an easygoing last stop before heading back to the hotel.',
                details: 'Open until ~1am Saturday',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/cHRyAQnnQoQznhEQ6' },
                  { text: 'Website', url: 'https://grittys.com/portland-brew-pub/?utm_source=google&utm_medium=mybusiness' }
                ]
              },
              {
                id: 'flask-lounge',
                title: 'Flask Lounge: Among Moon Flowers',
                time: '10:00p',
                tag: 'Dancing & Nightlife',
                description: 'Compact, high-energy bar and dance club with DJs, themed nights, and karaoke; on Saturdays it regularly runs until 1am, making it a good choice if you want to keep the night going with dancing a short walk from the State Theatre.',
                details: 'Open until ~1am Saturday',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/Xm18wMEehsy1EHEj7' },
                  { text: 'Website', url: 'https://flasklounge.com/' },
                  { text: 'Dec 20 Event', url: 'https://flasklounge.com/event/among-moon-flowers/' }
                ]
              }
            ]
          }
        ]
      },

      // ============================================
      // TAB 3: SUNDAY
      // ============================================
      sunday: {
        sections: [
          {
            id: 'early-morning',
            title: 'Optional: Early Morning Steam',
            description: 'Start the day with relaxation',
            selectionType: 'single',
            cards: [
              {
                id: 'washington-baths',
                title: 'Washington Baths (7am-12pm)',
                time: '7:00a',
                tag: 'Winter Solstice Special',
                description: 'Open 7am-12pm Sunday only (Winter Solstice!)',
                details: '$36/person, no time limit, closes at noon for rest of year. Sauna, cold plunge, hot pool. No reservations, all genders welcome.',
                links: [
                  { text: 'Website', url: 'https://washingtonbaths.com/' },
                  { text: 'FAQs', url: 'https://washingtonbaths.com/faq.html' }
                ]
              }
            ]
          },
          {
            id: 'brunch',
            title: 'Sunday Brunch',
            description: 'To help us start the day!',
            selectionType: 'single',
            cards: [
              {
                id: 'union',
                title: 'UNION',
                time: '10:00a',
                tag: 'Classic Brunch',
                description: '10am reservation confirmed, 3 min walk from hotel. Good coffee, solid food, no rush.',
                details: '10am reservation',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/gBATyXPNz5DhrUwL6' },
                  { text: 'Website', url: 'http://www.unionportland.com/' },
                  { text: 'Menu', url: 'https://thepresshotel.com/wp-content/uploads/2025/11/Fall-Brunch-Menu-2025-2.pdf' }
                ]
              },
              {
                id: 'the-juicery',
                title: 'The Juicery',
                time: '10:00a',
                tag: 'Light & Fresh',
                description: 'Old Port, health-focused. Smoothie bowls, avocado toast, fresh juice. Light & energizing before exploring. No reservation needed.',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/3EM1gDuyW1KoSxS69' },
                  { text: 'Website', url: 'https://juicery.com/locations-and-menus/portland/' },
                  { text: 'Order Ahead', url: 'https://orderjuicery.square.site/?location=11ea62fccaf5e5aba1470cc47a2aeaec#TE4ZF5ROZS6QJ6MXOZLSD5MM' }
                ]
              },
              {
                id: 'hot-suppa',
                title: 'Hot Suppa',
                time: '10:00a',
                tag: 'Comfort Food',
                description: 'Arts District, Southern comfort. Biscuits & gravy, fried chicken & waffles. Hearty, indulgent, stick-to-your-ribs brunch. Worth the wait if there\'s a line.',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/kfFceJcJ9dN79frK8' },
                  { text: 'Website', url: 'https://hotsuppa.com/' }
                ]
              }
            ]
          },
          {
            id: 'checkout',
            title: 'Hotel Checkout',
            description: 'Pack up and check out',
            selectionType: 'single',
            cards: [
              {
                id: 'hotel-checkout',
                title: '12:00 PM - Checkout',
                time: '12:00p',
                tag: 'Hotel',
                description: 'Pack up, say goodbye to harbor views'
              }
            ]
          },
          {
            id: 'afternoon',
            title: 'Sunday Afternoon Activities',
            description: 'Before heading home... (Select any)',
            selectionType: 'single',
            cards: [
              {
                id: 'shopping',
                title: 'Explore Old Port Shopping',
                time: '12:30p',
                tag: 'Wander & Explore',
                description: 'Browse Portland\'s best independent shops for vintage finds, premium menswear, and unique gifts. Six curated stops within easy walking distance of each other‚Äîspend as much or as little time as you want.',
                details: 'Old Port shopping district',
                address: 'Old Port, Portland, ME',
                links: [
                  { text: 'Shopping District', url: 'https://maps.app.goo.gl/TMwTqYxuPjjMQEmZA' }
                ],
                expandable: true,
                stores: [
                  {
                    id: 'viand-mercantile',
                    name: 'Viand Mercantile',
                    description: 'A rotating selection of vintage and antique pieces alongside new d√©cor, textiles, furniture, and small goods, often sourced from independent makers in Maine and beyond.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/LwXANijDnyf7utaE9' },
                      { text: 'Website', url: 'https://www.viandmercantile.com/' }
                    ]
                  },
                  {
                    id: 'portland-dry-goods',
                    name: 'Portland Dry Goods',
                    description: 'High-end, design‚Äëdriven casualwear and outerwear for men (and women) with a refined, slightly rugged vibe; great for premium denim, jackets, and elevated basics.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/nQc2mXJAFvyEWUNf6' },
                      { text: 'Website', url: 'http://portlanddrygoods.com/' }
                    ]
                  },
                  {
                    id: 'david-wood',
                    name: 'David Wood',
                    description: 'Classic, old‚Äëschool men\'s shop specializing in tailored clothing, custom suits, and polished casual pieces in a clubby, upscale setting.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/MH2tpmVFn4bBUznZ7' },
                      { text: 'Website', url: 'http://www.davidwood.com/' }
                    ]
                  },
                  {
                    id: 'josephs',
                    name: 'Joseph\'s of Portland',
                    description: 'Stylish brick‚Äëand‚Äëmortar men\'s store offering suits, tuxedos, custom tailoring, dress shoes, and sharp casualwear, good for weddings or a night‚Äëout upgrade.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/djQ3dpSYbWRTXaP36' },
                      { text: 'Website', url: 'https://josephsofportland.com/' }
                    ]
                  },
                  {
                    id: 'portland-trading',
                    name: 'Portland Trading Co',
                    description: 'Eclectic, well‚Äëcurated shop blending men\'s clothing with lifestyle and home goods; strong choice for modern, slightly artsy menswear and accessories.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/YvMJ8Vk6EK2oYPj8A' },
                      { text: 'Website', url: 'http://www.portlandtradingco.com/' }
                    ]
                  },
                  {
                    id: 'little-ghost',
                    name: 'Little Ghost',
                    description: 'Offbeat vintage clothing store with a wide range of authentic pieces and sizes; a fun stop if you want unique, one‚Äëoff menswear and accessories.',
                    links: [
                      { text: 'Directions', url: 'https://maps.app.goo.gl/GTzoJyNNuN4psdzN6' },
                      { text: 'Website', url: 'http://littleghostvintage.com/' }
                    ]
                  }
                ]
              },
              {
                id: 'pma-movie',
                title: 'Movie at Portland Museum of Art',
                time: '12:00p',
                tag: 'Film & Art',
                description: 'Watch Todd Haynes\' acclaimed psychological drama Safe (1995) with a special introduction by actor Xander Berkeley. Perfect for a rainy afternoon or film buffs.',
                details: 'Safe (1995), 12pm-2:05pm, Introduced by Xander Berkeley',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/4mF7G9jUJmg1YL3JA' },
                  { text: 'Museum', url: 'https://portlandmuseum.org' },
                  { text: 'Tickets', url: 'https://portlandmuseum.org/eventscalendar/safe-4' },
                  { text: 'Safe Trailer', url: 'https://youtu.be/MP3kLKLaiTw' }
                ]
              },
              {
                id: 'victoria-mansion',
                title: 'Victoria Mansion',
                time: '12:30p',
                tag: 'Museum & History',
                description: 'Didn\'t make it Saturday? This stunning Victorian house museum is worth the visit‚Äîdecked out for the holidays and perfect for architecture and history enthusiasts.',
                details: 'If you missed it Saturday, allow 1-1.5 hours',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/EnE277KkfbquWMmN7' },
                  { text: 'Website', url: 'https://victoriamansion.org' },
                  { text: 'Tickets', url: 'https://victoriamansion.org/visit-us' }
                ]
              },
              {
                id: 'portland-head-light',
                title: 'Portland Head Light',
                time: '12:30p',
                tag: 'Scenic Stop',
                description: 'Cape Elizabeth\'s iconic lighthouse at Fort Williams Park. Quintessential Maine photo op and scenic coastal views‚Äîfree to visit, 15 minutes from downtown.',
                details: 'Cape Elizabeth, iconic lighthouse, Fort Williams Park (free)',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/9dY5uEzJxz8Qnfaj9' },
                  { text: 'Website', url: 'https://portlandheadlight.com' }
                ]
              },
              {
                id: 'frost-factory-sunday',
                title: 'Frost Factory',
                time: '2:00p',
                tags: ['Cannabis Dispensary', 'Birthday Gift'],
                description: 'Last stop before heading home! South Portland, 10am-8pm Sunday.',
                details: 'Open 10am-8pm Sunday',
                links: [
                  { text: 'Directions', url: 'https://maps.app.goo.gl/D4ik3m1t8gCvXvjn8' },
                  { text: 'Website', url: 'https://thefrostfactory.com' },
                  { text: 'Preorder', url: 'https://weedmaps.com/dispensaries/the-frost-factory-2' }
                ]
              }
            ]
          }
        ]
      },

      // ============================================
      // TAB 4: HEADING HOME
      // ============================================
      headingHome: {
        sections: [
          {
            id: 'playlists',
            title: 'Playlists for the Drive',
            description: 'Pick your road trip soundtrack',
            selectionType: 'multiple',
            cards: [
              {
                id: 'playlist-matt',
                title: 'Matt',
                tags: ['Lovey', 'Fun'],
                description: 'All the songs that remind Meag of her man',
                links: [
                  { text: 'Spotify', url: 'https://open.spotify.com/playlist/3b3sqpWJxPz8CbHDPRbB2i' }
                ]
              },
              {
                id: 'playlist-babson',
                title: 'Babson Columbia \'25',
                tags: ['Memories', 'Joyful', 'Dancey'],
                description: 'All the jams from your epic trip to Columbia',
                links: [
                  { text: 'Spotify', url: 'https://open.spotify.com/playlist/5DVDPZQa1L4WnzDoPS6feo' }
                ]
              },
              {
                id: 'playlist-not-rap',
                title: 'Not Rap',
                tags: ['Movie Hits', 'Oldies', 'Classics'],
                description: 'The famous playlist you created for Meag early days',
                links: [
                  { text: 'Spotify', url: 'https://open.spotify.com/playlist/1DVV7dznCQmD4cEcLZsa2G' }
                ]
              },
              {
                id: 'playlist-acid-jazz',
                title: 'Acid Jazz',
                tags: ['Lev', 'Matthew', 'Anders', 'Matt', 'Honeybadger'],
                description: 'The classic, the essential, the inevitable',
                links: [
                  { text: 'Spotify', url: 'https://open.spotify.com/playlist/37i9dQZF1DWXHghfFFOaS6' }
                ]
              }
            ]
          }
        ]
      }
    };

    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let selections = {
      headingOut: {},
      saturdayNight: {},
      sunday: {},
      headingHome: {}
    };

    // Load saved selections from localStorage or URL
    function loadSelections() {
      // First, check URL for shared selections
      const urlParams = new URLSearchParams(window.location.search);
      const sharedData = urlParams.get('selections');

      if (sharedData) {
        try {
          // Decode and load from URL
          selections = JSON.parse(atob(sharedData));
          // Save to localStorage for persistence
          localStorage.setItem('lev-bday-2025', JSON.stringify(selections));
          // Clean URL (remove query params)
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        } catch (e) {
          console.error('Error loading shared selections:', e);
        }
      }

      // Otherwise, load from localStorage
      const saved = localStorage.getItem('lev-bday-2025');
      if (saved) {
        try {
          selections = JSON.parse(saved);
        } catch (e) {
          console.error('Error loading selections:', e);
        }
      }
    }

    // Save selections to localStorage
    function saveSelections() {
      localStorage.setItem('lev-bday-2025', JSON.stringify(selections));
      updateShareLink();
    }

    // Generate shareable link
    function updateShareLink() {
      const encoded = btoa(JSON.stringify(selections));
      const shareUrl = `${window.location.origin}${window.location.pathname}?selections=${encoded}`;

      // Update share link button if it exists
      const shareLinkBtn = document.getElementById('share-link-btn');
      if (shareLinkBtn) {
        shareLinkBtn.setAttribute('data-share-url', shareUrl);
      }
    }

    // Copy share link to clipboard
    function copyShareLink() {
      const shareLinkBtn = document.getElementById('share-link-btn');
      const shareUrl = shareLinkBtn.getAttribute('data-share-url');

      navigator.clipboard.writeText(shareUrl).then(() => {
        const originalText = shareLinkBtn.innerHTML;
        shareLinkBtn.innerHTML = '<img src="images/green_moose_icon.png" alt="Check" class="share-button-icon" style="filter: brightness(0) invert(1);"> Copied!';
        setTimeout(() => {
          shareLinkBtn.innerHTML = originalText;
        }, 2000);
      }).catch(err => {
        alert('Share URL: ' + shareUrl);
      });
    }

    // ============================================
    // RENDERING FUNCTIONS
    // ============================================

    function renderCard(card, sectionId, selectionType, tabKey) {
      const isSelected = selections[tabKey][sectionId]?.includes(card.id);

      // Handle both single tag (string) and multiple tags (array)
      let tagsHtml = '';
      if (card.tags && Array.isArray(card.tags)) {
        tagsHtml = card.tags.map(tag => `<span class="card-tag-badge">${tag}</span>`).join('');
      } else if (card.tag) {
        tagsHtml = `<span class="card-tag-badge">${card.tag}</span>`;
      }

      let html = `
        <div class="card ${isSelected ? 'selected' : ''}"
             data-card-id="${card.id}"
             data-section-id="${sectionId}"
             data-selection-type="${selectionType}"
             data-tab-key="${tabKey}">
          <div class="card-tags">${tagsHtml}</div>
          <div class="card-title">${card.title}</div>
          ${card.description ? `<div class="card-description">${card.description}</div>` : ''}
          ${card.details ? `<div class="card-details">${card.details}</div>` : ''}
      `;

      // Quick link buttons
      if (card.address || (card.links && card.links.length > 0)) {
        html += '<div class="card-quick-links">';

        // Directions button
        if (card.address) {
          const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(card.address)}`;
          html += `<a href="${mapsUrl}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üìç Directions</a>`;
        }

        // Website and Tickets buttons
        if (card.links && card.links.length > 0) {
          card.links.forEach(link => {
            if (link.text.toLowerCase().includes('direction')) {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üìç ${link.text}</a>`;
            } else if (link.text.toLowerCase().includes('ticket')) {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üéüÔ∏è Tickets</a>`;
            } else if (link.text.toLowerCase().includes('menu')) {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üçΩÔ∏è Menu</a>`;
            } else if (link.text.toLowerCase().includes('spotify')) {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üéµ Spotify</a>`;
            } else if (link.text.toLowerCase().includes('website') || link.text.toLowerCase().includes('site')) {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üåê Website</a>`;
            } else {
              html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üîó ${link.text}</a>`;
            }
          });
        }

        html += '</div>';
      }

      // Shopping stores expandable
      if (card.stores && card.stores.length > 0) {
        const expandId = `expand-${card.id}`;
        html += `
          <button class="expand-button ${isSelected ? 'enabled' : ''}" id="expand-btn-${card.id}" onclick="toggleExpand('${expandId}', event)">
            ${isSelected ? 'Show Store Details ‚ñº' : 'Select to see store options'}
          </button>
          <div class="expandable-content ${isSelected ? 'show' : ''}" id="${expandId}">
        `;

        card.stores.forEach(store => {
          const storeSelected = selections[tabKey][`${sectionId}-stores`]?.includes(store.id);
          html += `
            <div class="mini-card ${storeSelected ? 'selected' : ''}"
                 data-card-id="${store.id}"
                 data-section-id="${sectionId}-stores"
                 data-selection-type="multiple"
                 onclick="handleCardClick('${sectionId}-stores', '${store.id}', 'multiple', '${tabKey}', event)">
              <div class="mini-card-title">${store.name}</div>
              <div class="mini-card-description">${store.description}</div>
          `;

          // Add quick links for stores
          if (store.links && store.links.length > 0) {
            html += '<div class="card-quick-links">';
            store.links.forEach(link => {
              if (link.text.toLowerCase().includes('direction')) {
                html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üìç ${link.text}</a>`;
              } else if (link.text.toLowerCase().includes('website') || link.text.toLowerCase().includes('site')) {
                html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üåê Website</a>`;
              } else {
                html += `<a href="${link.url}" class="quick-link-btn" target="_blank" onclick="event.stopPropagation()">üîó ${link.text}</a>`;
              }
            });
            html += '</div>';
          }

          html += `</div>`;
        });

        html += '</div>';
      }

      html += '</div>';
      return html;
    }

    function renderSection(section, tabKey) {
      let html = `
        <div class="section">
          <h2 class="section-title">${section.title}</h2>
          ${section.description ? `<div class="section-description">${section.description}</div>` : ''}
          <div class="card-grid">
      `;

      section.cards.forEach(card => {
        html += renderCard(card, section.id, section.selectionType, tabKey);
      });

      html += '</div>';

      // Late night expandable (shows after selecting a show)
      if (section.expandable && section.expandCondition === 'show-selected') {
        const showSelected = selections[tabKey]['show'] && selections[tabKey]['show'].length > 0;
        html += `
          <div class="expandable-content ${showSelected ? 'show' : ''}" id="expand-late-night">
            <!-- Late night cards already rendered above -->
          </div>
        `;
      }

      html += '</div>';
      return html;
    }

    function renderAllContent() {
      // Save current tab states before re-rendering
      const tabStates = {};
      ['heading-out', 'saturday-night', 'sunday', 'heading-home'].forEach(tabId => {
        const content = document.getElementById(`tab-content-${tabId}`);
        if (content) {
          tabStates[tabId] = content.classList.contains('collapsed');
        }
      });

      const container = document.getElementById('content-container');
      let html = '';

      // Friday - Heading Out
      html += `
        <div class="tab-header" onclick="toggleTab('heading-out')">
          <h2><img src="images/green_lobster_decor.png" alt="Lobster" class="tab-icon"> Heading Out</h2>
          <button class="tab-collapse-btn" id="tab-btn-heading-out">‚ñº</button>
        </div>
        <div class="tab-content" id="tab-content-heading-out">
      `;
      CONTENT.headingOut.sections.forEach(section => {
        html += renderSection(section, 'headingOut');
      });
      html += '</div>';

      // Saturday Night
      html += `
        <div class="tab-header" onclick="toggleTab('saturday-night')">
          <h2>
            <img src="images/green_lighthouse_icon.png" alt="Lighthouse" class="tab-icon"> Saturday
            <span class="fantasy-reminder-badge">‚ö†Ô∏è Set Fantasy Lineup (5pm)</span>
          </h2>
          <button class="tab-collapse-btn" id="tab-btn-saturday-night">‚ñº</button>
        </div>
        <div class="tab-content" id="tab-content-saturday-night">
      `;
      CONTENT.saturdayNight.sections.forEach(section => {
        if (section.expandable && section.expandCondition === 'show-selected') {
          const showSelected = selections.saturdayNight['show'] && selections.saturdayNight['show'].length > 0;
          if (showSelected) {
            html += renderSection(section, 'saturdayNight');
          }
        } else {
          html += renderSection(section, 'saturdayNight');
        }
      });
      html += '</div>';

      // Sunday
      html += `
        <div class="tab-header" onclick="toggleTab('sunday')">
          <h2><img src="images/green_moose_icon.png" alt="Moose" class="tab-icon"> Sunday</h2>
          <button class="tab-collapse-btn" id="tab-btn-sunday">‚ñº</button>
        </div>
        <div class="tab-content" id="tab-content-sunday">
      `;
      CONTENT.sunday.sections.forEach(section => {
        html += renderSection(section, 'sunday');
      });
      html += '</div>';

      // Heading Home
      html += `
        <div class="tab-header" onclick="toggleTab('heading-home')">
          <h2><img src="images/green_tracks_button.png" alt="Tracks" class="tab-icon"> Heading Home</h2>
          <button class="tab-collapse-btn" id="tab-btn-heading-home">‚ñº</button>
        </div>
        <div class="tab-content" id="tab-content-heading-home">
      `;
      CONTENT.headingHome.sections.forEach(section => {
        html += renderSection(section, 'headingHome');
      });
      html += '</div>';

      container.innerHTML = html;

      // Restore tab states
      Object.keys(tabStates).forEach(tabId => {
        const content = document.getElementById(`tab-content-${tabId}`);
        const btn = document.getElementById(`tab-btn-${tabId}`);
        if (content && btn && tabStates[tabId]) {
          content.classList.add('collapsed');
          btn.classList.add('collapsed');
        }
      });

      // Attach click handlers to all cards
      attachCardHandlers();
    }

    // ============================================
    // EVENT HANDLERS
    // ============================================

    function toggleTab(tabId) {
      const content = document.getElementById(`tab-content-${tabId}`);
      const btn = document.getElementById(`tab-btn-${tabId}`);

      if (content && btn) {
        content.classList.toggle('collapsed');
        btn.classList.toggle('collapsed');
      }
    }

    function attachCardHandlers() {
      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', (e) => {
          const sectionId = card.dataset.sectionId;
          const cardId = card.dataset.cardId;
          const selectionType = card.dataset.selectionType;
          const tabKey = card.dataset.tabKey;
          handleCardClick(sectionId, cardId, selectionType, tabKey, e);
        });
      });
    }

    function handleCardClick(sectionId, cardId, selectionType, tabKey, event) {
      if (event) event.stopPropagation();

      // Ensure the correct tab is open
      ensureTabOpen(tabKey);

      if (!selections[tabKey][sectionId]) {
        selections[tabKey][sectionId] = [];
      }

      if (selectionType === 'single') {
        // Radio button behavior with toggle-off capability
        if (selections[tabKey][sectionId][0] === cardId) {
          // If clicking the same card, unselect it
          selections[tabKey][sectionId] = [];
        } else {
          // Otherwise select the new card
          selections[tabKey][sectionId] = [cardId];
        }
      } else {
        // Multiple selection with departure time limits for before-checkin
        const index = selections[tabKey][sectionId].indexOf(cardId);
        if (index > -1) {
          // Unselect
          selections[tabKey][sectionId].splice(index, 1);
        } else {
          // Check if this is before-checkin section and enforce limits
          if (sectionId === 'before-checkin' && tabKey === 'headingOut') {
            const maxActivities = getMaxBeforeCheckinActivities();
            if (selections[tabKey][sectionId].length >= maxActivities) {
              alert(`You can select up to ${maxActivities} activit${maxActivities === 1 ? 'y' : 'ies'} based on your ${getDepartureTimeLabel()} departure time.`);
              return;
            }
          }
          // Select
          selections[tabKey][sectionId].push(cardId);
        }
      }

      saveSelections();
      renderAllContent();
      updateSummary();

      // Handle expandables
      if (sectionId === 'show') {
        updateLateNightVisibility();
      }
    }

    // Ensure the correct tab is open when clicking a card
    function ensureTabOpen(tabKey) {
      const tabIdMap = {
        'headingOut': 'heading-out',
        'saturdayNight': 'saturday-night',
        'sunday': 'sunday',
        'headingHome': 'heading-home'
      };

      const tabId = tabIdMap[tabKey];
      if (!tabId) return;

      const content = document.getElementById(`tab-content-${tabId}`);
      const btn = document.getElementById(`tab-btn-${tabId}`);

      if (content && btn && content.classList.contains('collapsed')) {
        // Open this tab if it's collapsed
        content.classList.remove('collapsed');
        btn.classList.remove('collapsed');
      }
    }

    // Get max before-checkin activities based on departure time
    function getMaxBeforeCheckinActivities() {
      const departureTime = selections.headingOut['departure-time'];
      if (!departureTime || departureTime.length === 0) return 999; // No limit if no departure time selected

      const selected = departureTime[0];
      if (selected === 'depart-10am') return 3;
      if (selected === 'depart-11am') return 2;
      if (selected === 'depart-12pm') return 1;
      return 999;
    }

    // Get departure time label for alert message
    function getDepartureTimeLabel() {
      const departureTime = selections.headingOut['departure-time'];
      if (!departureTime || departureTime.length === 0) return '';

      const selected = departureTime[0];
      if (selected === 'depart-10am') return '10:00 AM';
      if (selected === 'depart-11am') return '11:00 AM';
      if (selected === 'depart-12pm') return '12:00 PM';
      return '';
    }

    function toggleExpand(expandId, event) {
      event.stopPropagation();
      const element = document.getElementById(expandId);
      element.classList.toggle('show');
    }

    function updateLateNightVisibility() {
      const showSelected = selections.saturdayNight['show'] && selections.saturdayNight['show'].length > 0;
      const lateNightSection = document.getElementById('expand-late-night');
      if (lateNightSection) {
        if (showSelected) {
          lateNightSection.classList.add('show');
        } else {
          lateNightSection.classList.remove('show');
        }
      }
    }

    // ============================================
    // SUMMARY PANEL
    // ============================================

    function updateSummary() {
      const summaryContent = document.getElementById('summary-content');
      let html = '';
      let hasSelections = false;

      // Helper to convert kebab-case to camelCase
      function toCamelCase(str) {
        return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
      }

      // Helper to get card info by ID
      function getCardInfo(tabKey, sectionId, cardId) {
        const camelKey = toCamelCase(tabKey);
        const tab = CONTENT[camelKey];
        if (!tab) return { title: cardId, time: '' };

        for (const section of tab.sections) {
          if (section.id === sectionId) {
            const card = section.cards.find(c => c.id === cardId);
            if (card) return { title: card.title, time: card.time || '', card: card };
          }

          // Check stores
          for (const card of section.cards) {
            if (card.stores && sectionId.includes('stores')) {
              const store = card.stores.find(s => s.id === cardId);
              if (store) return { title: store.name, time: '', isStore: true };
            }
          }
        }
        return { title: cardId, time: '' };
      }

      // Collect all selections organized by day
      const saturday = [];
      const sunday = [];

      // Helper to add item to day array (handles both single and multiple selections)
      function addItem(dayArray, tabKey, sectionId, cardIds) {
        if (cardIds.length === 0) return;

        const camelKey = toCamelCase(tabKey);
        const hideTime = sectionId === 'before-checkin';

        // Process each card (handles multiple selections)
        cardIds.forEach(cardId => {
          const info = getCardInfo(tabKey, sectionId, cardId);

          // Check if this is shopping with stores selected
          if (info.card && info.card.stores && selections[camelKey][`${sectionId}-stores`]) {
            const storeIds = selections[camelKey][`${sectionId}-stores`];
            const storeNames = storeIds.map(storeId => {
              const storeInfo = getCardInfo(tabKey, `${sectionId}-stores`, storeId);
              return storeInfo.title;
            });
            dayArray.push({
              time: hideTime ? '' : (info.time || ''),
              title: `${info.title}: ${storeNames.join('; ')};`
            });
          } else {
            dayArray.push({
              time: hideTime ? '' : (info.time || ''),
              title: info.title
            });
          }
        });
      }

      // Collect Saturday items (Heading Out + Saturday Night)
      for (const [sectionId, cardIds] of Object.entries(selections.headingOut)) {
        addItem(saturday, 'heading-out', sectionId, cardIds);
      }
      for (const [sectionId, cardIds] of Object.entries(selections.saturdayNight)) {
        if (!sectionId.includes('stores')) {
          addItem(saturday, 'saturday-night', sectionId, cardIds);
        }
      }

      // Add Fantasy Football reminder to Saturday (always appears)
      saturday.push({
        time: '5:00p',
        title: 'Set Fantasy Lineup ‚ö†Ô∏è'
      });

      // Collect Sunday items (Sunday + Heading Home)
      for (const [sectionId, cardIds] of Object.entries(selections.sunday)) {
        if (!sectionId.includes('stores')) {
          addItem(sunday, 'sunday', sectionId, cardIds);
        }
      }
      for (const [sectionId, cardIds] of Object.entries(selections.headingHome)) {
        if (sectionId !== 'playlists') {  // Exclude playlists from summary
          addItem(sunday, 'heading-home', sectionId, cardIds);
        }
      }

      // Render Saturday
      if (saturday.length > 0) {
        html += '<div class="summary-day">SATURDAY</div>';
        saturday.forEach(item => {
          const timeStr = item.time ? item.time.padEnd(7) : '       ';
          html += `<div class="summary-item">${timeStr} ${item.title}</div>`;
          hasSelections = true;
        });
      }

      // Render Sunday
      if (sunday.length > 0) {
        html += '<div class="summary-day">SUNDAY</div>';
        sunday.forEach(item => {
          const timeStr = item.time ? item.time.padEnd(7) : '       ';
          html += `<div class="summary-item">${timeStr} ${item.title}</div>`;
          hasSelections = true;
        });
      }

      if (!hasSelections) {
        summaryContent.innerHTML = '<div class="summary-empty">Make selections below to build your weekend!</div>';
      } else {
        summaryContent.innerHTML = html;
      }
    }

    // ============================================
    // INITIALIZATION
    // ============================================

    document.addEventListener('DOMContentLoaded', function() {
      // Load saved selections
      loadSelections();

      // Render all content
      renderAllContent();

      // Collapse all tabs by default
      ['heading-out', 'saturday-night', 'sunday', 'heading-home'].forEach(tabId => {
        const content = document.getElementById(`tab-content-${tabId}`);
        const btn = document.getElementById(`tab-btn-${tabId}`);
        if (content && btn) {
          content.classList.add('collapsed');
          btn.classList.add('collapsed');
        }
      });

      // Update summary
      updateSummary();

      // Initialize share link
      updateShareLink();

      // Full screen summary toggle
      document.getElementById('expand-summary-btn').addEventListener('click', () => {
        const modal = document.getElementById('summary-modal');
        const modalContent = document.getElementById('summary-modal-content');
        const summaryContent = document.getElementById('summary-content');
        modalContent.innerHTML = summaryContent.innerHTML;
        modal.classList.add('show');
      });

      document.getElementById('close-summary-modal').addEventListener('click', () => {
        document.getElementById('summary-modal').classList.remove('show');
      });

      // Close modal on background click
      document.getElementById('summary-modal').addEventListener('click', (e) => {
        if (e.target.id === 'summary-modal') {
          e.target.classList.remove('show');
        }
      });

      // Reset button
      document.getElementById('reset-btn').addEventListener('click', () => {
        if (confirm('Reset all selections? This cannot be undone.')) {
          selections = {
            headingOut: {},
            saturdayNight: {
              show: ['pink-talking-fish']
            },
            sunday: {
              brunch: ['union']
            },
            headingHome: {}
          };
          saveSelections();
          renderAllContent();
          updateSummary();
        }
      });

      // Reset header button
      document.getElementById('reset-header-btn').addEventListener('click', () => {
        if (confirm('Reset all selections? This cannot be undone.')) {
          selections = {
            headingOut: {},
            saturdayNight: {
              show: ['pink-talking-fish']
            },
            sunday: {
              brunch: ['union']
            },
            headingHome: {}
          };
          saveSelections();
          renderAllContent();
          updateSummary();
        }
      });
    });
  </script>
</body>
</html>
